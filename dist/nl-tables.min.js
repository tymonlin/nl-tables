angular.module("nlTables",[]).directive("nlTables",["StringUtils",function(t){return{restrict:"EA",scope:{table:"=",showTableIndex:"@",checkbox:"@",radio:"@"},controller:["$scope",function(e){e.getColumnHtml=function(t,e){return t.format?t.format(e):e[t.name]},e.getCountColumnHtml=function(e,n){if(e.countFormat)return e.countFormat(n);if(t.isEmpty(e))return"";var a=n[e.countColumn];return a},e.tdClick=function(t,e,n){return void 0==t.click?void 0:t.click(e,n)},e.checkboxAllClick=function(){e.table.checkAll()},e.checkboxChange=function(t,n){"function"==typeof e.table.checkboxChange&&e.table.checkboxChange(t,n),e.radio&&t.selected&&angular.forEach(e.table.data,function(t){angular.equals(t,changeRow)||(t.selected=!1,"function"==typeof e.table.checkboxChange&&e.table.checkboxChange(t,n))})},e.iconClick=function(t,e,n){"function"==typeof t.iconClick&&t.iconClick(e,n)},e.ignoreCount=0,e.showTableIndex&&(e.ignoreCount+=1),(e.checkBox||e.radio)&&(e.ignoreCount+=1)}],template:"<div>   <table class='table table-striped table-hover table-bordered table-vmiddle table-condensed'>       <thead>           <tr>               <td ng-if='showTableIndex'>#</td>               <td ng-if='checkbox' class='text-center' ng-click='checkboxAllClick()' style='cursor: pointer;'>全选</td>               <td ng-if='radio' class='text-center' style='cursor: pointer;'>选择</td>              <td ng-repeat='column in table.columns' class='{{column.class}}'>{{column.title}}</td>          </tr>       </thead>       <tbody>           <tr ng-if='table.data == undefined || table.data.length == 0'>               <td class='text-center tr-no-data' colspan='{{table.columns.length + 1}}'>                   <span>{{table.tip.notFoundRecord}}</span>               </td>           </tr>           <tr ng-if='table.data.length > 0' class='nl-table-body-tr' ng-repeat='row in table.data' ng-init='rowIndex = $index'>               <td ng-if='showTableIndex'>{{$index + 1}}</td>               <td ng-if='checkbox || radio' class='text-center'><input type='checkbox' ng-change='checkboxChange(row, $index)' ng-model='row.selected'></td>               <td ng-repeat='column in table.columns' class='{{column.class}}'                   ng-click='tdClick(column, row, rowIndex)'>                   <span ng-bind-html='getColumnHtml(column, row)|trustAsHtml'></span>                    <i ng-if='column.iconClass != undefined' class='pull-right {{column.iconClass}}' ng-click='iconClick(column, row, $index)'></i>               </td>           </tr>       </tbody>       <tfoot ng-if='table.statisticsRow != undefined && table.statisticsRow != {}'>           <tr><td class='text-center'>统计</td>               <td ng-repeat='column in table.columns' ng-if='!($index == 0 && ignoreCount==0)'                    ng-bind-html='getCountColumnHtml(column, table.statisticsRow) | trustAsHtml'></td>           </tr>       </tfoot>   </table></div>",replace:!0}}]).directive("nlTurnPage",function(){return{restrict:"EA",scope:{table:"="},template:"<ul class='pagination'>   <li><span>一共 {{table.rows}} 条记录，每页 {{table.pageSize}} 条，共 {{table.pageCount}} 页</span></li>   <li ng-class='{disabled:(table.pageNo == 1) }'>       <a ng-click='table.pre()'><span aria-hidden='true'>&laquo;</span></a>   </li>   <li ng-repeat='i in table.pages' ng-class='{active:(i.index == table.pageNo)}'>       <a ng-click='table.go(i.index)'>{{i.text}}</a>   </li>   <li ng-class='{disabled:(table.pageNo == table.pageCount) }'>       <a ng-click='table.next()' ><span aria-hidden='true'>&raquo;</span></a>   </li></ul>",replace:!0}}).factory("NLTables",function(){function t(t,e,n){n=n||{};var a={columns:t,pageSize:n.pageSize||15,splitPages:2,pageCount:0,pageNo:0,nextPage:n?n.pageNo||1:1,prePage:n?n.pageNo||1:1,tip:{notFoundRecord:"未找到记录"},go:function(t){if(this.pageNo!=t){this.pageNo=t;var a=this;n&&(n.pageNo=t),e(n||{},function(t){a=angular.extend(a,t),a.build()})}},refresh:function(){var t=this;e(n||{},function(e){t.isCheckAll=!1,t=angular.extend(t,e),t.build()})},build:function(){var t=Math.ceil(this.rows/this.pageSize);this.pageCount=0==t?1:t;var e=new Array;this.splitPages=this.splitPages<=3?3:this.splitPages;for(var n=0,a=0;t>a&&(0!=a&&a+2<=this.pageNo-this.splitPages?(e[n]={index:this.pageNo-2*this.splitPages-1,text:"……"},a=this.pageNo-this.splitPages-2):a==this.pageNo+this.splitPages&&a+1!=this.pageCount?(e[n]={index:a+1+this.splitPages,text:"……"},a=t-2):e[n]={index:a+1,text:a+1},n++,!(n>20));a++);this.pages=e,this.nextPage=this.pageNo+1>t?t:this.pageNo+1,this.prePage=1==this.pageNo?1:this.pageNo-1},next:function(){this.pageNo+1>this.pageCount||this.go(this.pageNo+1)},pre:function(){1!=this.pageNo&&this.go(this.pageNo-1)},checkAll:function(){if(void 0!=this.data){1!=this.isCheckAll?this.isCheckAll=!0:this.isCheckAll=!1;for(var t=0;t<this.data.length;t++){var e=this.data[t];e&&(e.selected=this.isCheckAll),"function"==typeof this.checkboxChange&&this.checkboxChange(e,t+1)}}},getSelected:function(t){var e=[];return angular.forEach(this.data,function(n,a){if(n.selected){var i=t(n,a);void 0!=i&&e.push(i)}}),e},pages:[]};return a.go(n?n.pageNo||1:1),a}return t});