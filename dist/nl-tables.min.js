angular.module("nlTables",[]).directive("nlTables",function(){return{restrict:"EA",scope:{table:"=",showTableIndex:"@",checkbox:"@",radio:"@"},controller:["$scope",function(e){e.getColumnHtml=function(e,t){return e.format?e.format(t):t[e.name]},e.tdClick=function(e,t){return void 0==e.click?void 0:e.click(t)},e.changeRadio=function(t){t.selected&&angular.forEach(e.table.data,function(e){angular.equals(e,t)||(e.selected=!1)})}}],template:"<div><table class='table table-striped table-hover table-bordered table-vmiddle table-condensed'>   <thead>       <tr>           <td ng-if='showTableIndex'>#</td>           <td ng-show='checkbox' class='text-center' ng-click='table.checkAll()' style='cursor: pointer;'>全选</td>           <td ng-show='radio' class='text-center' style='cursor: pointer;'>选择</td>           <td ng-repeat='column in table.columns' class='{{column.class}}'>{{column.title}}</td>       </tr>   </thead>   <tbody>       <tr ng-if='table.data == undefined || table.data.length == 0'>           <td class='text-center tr-no-data' colspan='{{table.columns.length + 1}}'>               <span>{{table.tip.notFoundRecord}}</span>           </td>       </tr>       <tr ng-if='table.data.length > 0' ng-repeat='row in table.data'>           <td ng-if='showTableIndex'>{{$index + 1}}</td>           <td ng-show='checkbox | radio' class='text-center'><input type='checkbox' ng-click='radio ? changeRadio(row) : undefined' ng-model='row.selected'></td>           <td ng-repeat='column in table.columns' class='{{column.class}}'                ng-bind-html='getColumnHtml(column, row)|trustAsHtml' ng-click='tdClick(column, row)'></td>       </tr>   </tbody></table></div>",replace:!0}}).directive("nlTurnPage",function(){return{restrict:"EA",scope:{table:"="},template:"<ul class='pagination'>   <li><span>一共 {{table.rows}} 条记录，每页 {{table.pageSize}} 条，共 {{table.pageCount}} 页</span></li>   <li ng-class='{disabled:(table.pageNo == 1) }'>       <a ng-click='table.pre()'><span aria-hidden='true'>&laquo;</span></a>   </li>   <li ng-repeat='i in table.pages' ng-class='{active:(i.index == table.pageNo)}'>       <a ng-click='table.go(i.index)'>{{i.text}}</a>   </li>   <li ng-class='{disabled:(table.pageNo == table.pageCount) }'>       <a ng-click='table.next()' ><span aria-hidden='true'>&raquo;</span></a>   </li></ul>",replace:!0}}).factory("NLTables",function(){function e(e,t,a){var i={columns:e,pageSize:a.pageSize,splitPages:2,pageCount:0,pageNo:0,nextPage:a?a.pageNo||1:1,prePage:a?a.pageNo||1:1,tip:{notFoundRecord:"未找到记录"},go:function(e){if(this.pageNo!=e){this.pageNo=e;var i=this;a&&(a.pageNo=e),t(a||{},function(e){i=angular.extend(i,e),i.build()})}},refresh:function(){var e=this;t(a||{},function(t){e.isCheckAll=!1,e=angular.extend(e,t),e.build()})},build:function(){var e=Math.ceil(this.rows/this.pageSize);this.pageCount=0==e?1:e;var t=new Array;this.splitPages=this.splitPages<=3?3:this.splitPages;for(var a=0,i=0;e>i&&(0!=i&&i+2<=this.pageNo-this.splitPages?(t[a]={index:this.pageNo-2*this.splitPages-1,text:"……"},i=this.pageNo-this.splitPages-2):i==this.pageNo+this.splitPages&&i+1!=this.pageCount?(t[a]={index:i+1+this.splitPages,text:"……"},i=e-2):t[a]={index:i+1,text:i+1},a++,!(a>20));i++);this.pages=t,this.nextPage=this.pageNo+1>e?e:this.pageNo+1,this.prePage=1==this.pageNo?1:this.pageNo-1},next:function(){this.pageNo+1>this.pageCount||this.go(this.pageNo+1)},pre:function(){1!=this.pageNo&&this.go(this.pageNo-1)},checkAll:function(){if(void 0!=this.data){1!=this.isCheckAll?this.isCheckAll=!0:this.isCheckAll=!1;for(var e=0;e<this.data.length;e++){var t=this.data[e];t&&(t.selected=this.isCheckAll)}}},getSelected:function(e){var t=[];return angular.forEach(this.data,function(a){a.selected&&t.push(e(a))}),t},pages:[]};return i.go(a?a.pageNo||1:1),i}return e});