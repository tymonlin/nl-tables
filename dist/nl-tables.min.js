angular.module("nlTables",["com.newland.util"]).directive("nlTables",["StringUtils",function(t){return{restrict:"EA",scope:{table:"=",showTableIndex:"@",checkbox:"@",radio:"@"},controller:["$scope",function(e){e.getColumnHtml=function(t,e){return t.format?t.format(e):e[t.name]},e.getCountColumnHtml=function(e,a){return e.countFormat?e.countFormat(a):t.isEmpty(e)?"":a[e.countColumn]},e.tdClick=function(t,e){return void 0==t.click?void 0:t.click(e)},e.changeRadio=function(t){t.selected&&angular.forEach(e.table.data,function(e){angular.equals(e,t)||(e.selected=!1)})},e.ignoreCount=0,e.showTableIndex&&(e.ignoreCount+=1),(e.checkBox||e.radio)&&(e.ignoreCount+=1)}],template:"<div>   <table class='table table-striped table-hover table-bordered table-vmiddle table-condensed'>       <thead>           <tr>               <td ng-if='showTableIndex'>#</td>               <td ng-if='checkbox' class='text-center' ng-click='table.checkAll()' style='cursor: pointer;'>全选</td>               <td ng-if='radio' class='text-center' style='cursor: pointer;'>选择</td>              <td ng-repeat='column in table.columns' class='{{column.class}}'>{{column.title}}</td>          </tr>       </thead>       <tbody>           <tr ng-if='table.data == undefined || table.data.length == 0'>               <td class='text-center tr-no-data' colspan='{{table.columns.length + 1}}'>                   <span>{{table.tip.notFoundRecord}}</span>               </td>           </tr>           <tr ng-if='table.data.length > 0' ng-repeat='row in table.data'>               <td ng-if='showTableIndex'>{{$index + 1}}</td>               <td ng-if='checkbox || radio' class='text-center'><input type='checkbox' ng-click='radio ? changeRadio(row) : undefined' ng-model='row.selected'></td>               <td ng-repeat='column in table.columns' class='{{column.class}}'                    ng-bind-html='getColumnHtml(column, row)|trustAsHtml' ng-click='tdClick(column, row)'></td>           </tr>       </tbody>       <tfoot ng-if='table.statisticsRow != undefined && table.statisticsRow != {}'>           <tr><td class='text-center'>统计</td>               <td ng-repeat='column in table.columns' ng-if='!($index == 0 && ignoreCount==0)'                    ng-bind-html='getCountColumnHtml(column, table.statisticsRow) | trustAsHtml'></td>           </tr>       </tfoot>   </table></div>",replace:!0}}]).directive("nlTurnPage",function(){return{restrict:"EA",scope:{table:"="},template:"<ul class='pagination'>   <li><span>一共 {{table.rows}} 条记录，每页 {{table.pageSize}} 条，共 {{table.pageCount}} 页</span></li>   <li ng-class='{disabled:(table.pageNo == 1) }'>       <a ng-click='table.pre()'><span aria-hidden='true'>&laquo;</span></a>   </li>   <li ng-repeat='i in table.pages' ng-class='{active:(i.index == table.pageNo)}'>       <a ng-click='table.go(i.index)'>{{i.text}}</a>   </li>   <li ng-class='{disabled:(table.pageNo == table.pageCount) }'>       <a ng-click='table.next()' ><span aria-hidden='true'>&raquo;</span></a>   </li></ul>",replace:!0}}).factory("NLTables",function(){function t(t,e,a){a=a||{};var n={columns:t,pageSize:a.pageSize||15,splitPages:2,pageCount:0,pageNo:0,nextPage:a?a.pageNo||1:1,prePage:a?a.pageNo||1:1,tip:{notFoundRecord:"未找到记录"},go:function(t){if(this.pageNo!=t){this.pageNo=t;var n=this;a&&(a.pageNo=t),e(a||{},function(t){n=angular.extend(n,t),n.build()})}},refresh:function(){var t=this;e(a||{},function(e){t.isCheckAll=!1,t=angular.extend(t,e),t.build()})},build:function(){var t=Math.ceil(this.rows/this.pageSize);this.pageCount=0==t?1:t;var e=new Array;this.splitPages=this.splitPages<=3?3:this.splitPages;for(var a=0,n=0;t>n&&(0!=n&&n+2<=this.pageNo-this.splitPages?(e[a]={index:this.pageNo-2*this.splitPages-1,text:"……"},n=this.pageNo-this.splitPages-2):n==this.pageNo+this.splitPages&&n+1!=this.pageCount?(e[a]={index:n+1+this.splitPages,text:"……"},n=t-2):e[a]={index:n+1,text:n+1},a++,!(a>20));n++);this.pages=e,this.nextPage=this.pageNo+1>t?t:this.pageNo+1,this.prePage=1==this.pageNo?1:this.pageNo-1},next:function(){this.pageNo+1>this.pageCount||this.go(this.pageNo+1)},pre:function(){1!=this.pageNo&&this.go(this.pageNo-1)},checkAll:function(){if(void 0!=this.data){1!=this.isCheckAll?this.isCheckAll=!0:this.isCheckAll=!1;for(var t=0;t<this.data.length;t++){var e=this.data[t];e&&(e.selected=this.isCheckAll)}}},getSelected:function(t){var e=[];return angular.forEach(this.data,function(a){a.selected&&e.push(t(a))}),e},pages:[]};return n.go(a?a.pageNo||1:1),n}return t});