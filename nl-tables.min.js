!function(o){var e=o.module("module.newland.table",[]);e.directive("nlTables",function(){return{restrict:"EA",scope:{table:"=",selectedRow:"=",selectRow:"&",showTableIndex:"@",checkbox:"@",radio:"@",unselected:"@",selectRowFlag:"@"},controller:["$scope",function(l){l.autoUnselected=null==l.unselected||""==l.unselected||Boolean.valueOf(l.unselected),l.selectedFlag=null!=l.selectRowFlag&&(""==l.selectRowFlag||Boolean.valueOf(l.selectRowFlag)),l.getColumnHtml=function(e,t){return e.format?e.format(t):t[e.name]},l.getCountColumnHtml=function(e,t){return e.countFormat?e.countFormat(t):StringUtils.isEmpty(e.countColumn)?"":t[e.countColumn]},l.tdClick=function(e,t,n,a){if(l.hasCheckboxOrRadio()&&(t.selected=!t.selected,l.checkboxChange(t,a)),null==e.click&&l.selectedFlag)l.selectedRow=null!=l.selectedRow&&l.autoUnselected&&o.equals(t,l.selectedRow)?void 0:t;else if(null!=e.click)return e.click(t,n)},l.isSelected=function(e){var t=l.selectRow();return null==t&&l.selectedFlag?o.equals(e,l.selectedRow):null!=t&&t},l.checkboxChange=function(t,n){"function"==typeof l.table.checkboxChange&&l.table.checkboxChange(t,n),l.hasRadio()&&t.selected&&o.forEach(l.table.data,function(e){o.equals(e,t)||(e.selected=!1,"function"==typeof l.table.checkboxChange&&l.table.checkboxChange(e,n))})},l.iconClick=function(e,t,n){"function"==typeof e.iconClick&&e.iconClick(t,n)},l.hasCheckboxOrRadio=function(){return""==l.checkbox||"true"==l.checkbox||""==l.radio||"true"==l.radio},l.hasCheckbox=function(){return""==l.checkbox||"true"==l.checkbox},l.hasRadio=function(){return""==l.radio||"true"==l.radio},l.show=function(e){return"function"==typeof e.show?e.show():"boolean"!=typeof e.show||e.show},l.ignoreCount=0,l.showTableIndex&&(l.ignoreCount+=1);l.hasCheckboxOrRadio()&&(l.ignoreCount+=1)}],template:"<div>   <table class='table table-striped table-hover table-bordered table-vmiddle table-condensed'>       <thead>           <tr style='font-weight: bold;'>               <td ng-if='showTableIndex'>#</td>               <td ng-if='hasCheckbox()' class='text-center' ng-click='table.checkAll()' style='cursor: pointer;'>{{'checkAll'|NLTableTranslate}}</td>               <td ng-if='hasRadio()' class='text-center' style='cursor: pointer;'>{{ 'select' | NLTableTranslate}}</td>              <td ng-repeat='column in table.columns' ng-show='show(column)' class='{{column.class}}'>{{column.title ? column.title : (column.translateKey | NLTableTranslate)}}</td>          </tr>       </thead>       <tbody>           <tr ng-if='table.data == undefined || table.data.length == 0'><td class='text-center tr-no-data' colspan='{{table.columns.length + 1}}'><span>{{table.tip.notFoundRecord}}</span></td></tr>           <tr ng-if='table.data.length > 0' class='nl-table-body-tr' ng-repeat='row in table.data' ng-init='rowIndex = $index' data-ng-class=\"{true:'selected'}[isSelected(row)]\">               <td ng-if='showTableIndex'>{{$index + 1}}</td>               <td ng-if='hasCheckboxOrRadio()' class='text-center'><input type='checkbox' ng-change='checkboxChange(row, $index)' ng-model='row.selected'></td>               <td ng-repeat='column in table.columns' class='{{column.class}}'                    ng-show='show(column)'                    ng-click='tdClick(column, row, $index, rowIndex)'>                   <span ng-bind-html='getColumnHtml(column, row)|trustAsHtml'></span>                    <i ng-if='column.iconClass != undefined' class='pull-right {{column.iconClass}}' ng-click='iconClick(column, row, $index)'></i>               </td>           </tr>       </tbody>       <tfoot ng-if='table.rows > 0 && table.statisticsRow != undefined && table.statisticsRow != {}'>           <tr style='background-color: #CCFFFF'><td class='text-center'>{{ 'statistics' | NLTableTranslate}}</td>               <td ng-repeat='column in table.columns' ng-if='!($index == 0 && ignoreCount==0)' class='{{column.class}}'                    ng-bind-html='getCountColumnHtml(column, table.statisticsRow) | trustAsHtml'></td>           </tr>       </tfoot>   </table></div>",replace:!0}}),e.filter("trustAsHtml",["$sce",function(t){return function(e){return null==e?"":(e+="",t.trustAsHtml(e))}}]),e.directive("nlTurnPage",function(){return{restrict:"EA",scope:{table:"="},template:"<ul class='pagination nl-table-turnpage'>   <li><span>{{ 'turnpage_word_1' | NLTableTranslate}} {{table.rows}} {{ 'turnpage_word_2' | NLTableTranslate}} {{table.pageCount}} {{ 'turnpage_word_4' | NLTableTranslate}}</span></li>   <li ng-class='{disabled:(table.pageNo == 1) }'><a ng-click='table.pre()'><span aria-hidden='true'>&laquo;</span></a></li>   <li ng-repeat='i in table.pages' ng-class='{active:(i.index == table.pageNo)}'><a ng-click='table.go(i.index)'>{{i.text}}</a></li>   <li ng-class='{disabled:(table.pageNo == table.pageCount) }'><a ng-click='table.next()' ><span aria-hidden='true'>&raquo;</span></a></li></ul>",replace:!0}}),e.factory("NLListTable",function(){return function(e,n){var t={columns:e,tip:{notFoundRecord:"未找到记录"},refresh:function(){var t=this;n(function(e){return t.isCheckAll=!1,(t=o.extend(t,e)).build(),t})},build:function(){n(function(e){t.data=e})},checkAll:function(){null!=this.data&&(this.isCheckAll=!this.isCheckAll,o.forEach(this.data,function(e){e.selected!=t.isCheckAll&&"function"==typeof t.checkboxChange&&t.checkboxChange(e,i+1),e.selected=t.isCheckAll}))},getSelected:function(a){var l=[];return o.forEach(this.data,function(e,t){var n;!e.selected||null!=(n=a(e,t))&&l.push(n)}),l}};return t.build(),t}}),e.factory("NLTables",function(){return function(e,n,a){var t={columns:e,pageSize:(a=a||{}).pageSize||15,splitPages:2,pageCount:0,pageNo:0,nextPage:a&&a.pageNo||1,prePage:a&&a.pageNo||1,tip:{notFoundRecord:"未找到记录"},go:function(e){var t;this.pageNo!=e&&(this.pageNo=e,t=this,a&&(a.pageNo=e),n(a||{},function(e){(t=o.extend(t,e)).build()}))},refresh:function(){var t=this;n(a||{},function(e){t.isCheckAll=!1,(t=o.extend(t,e)).build()})},build:function(){var e=Math.ceil(this.rows/this.pageSize);this.pageCount=0==e?1:e;var t=new Array;this.splitPages=this.splitPages<=3?3:this.splitPages;for(var n=0,a=0;a<e&&(0!=a&&a+2<=this.pageNo-this.splitPages?(t[n]={index:this.pageNo-2*this.splitPages-1,text:"……"},a=this.pageNo-this.splitPages-2):a==this.pageNo+this.splitPages&&a+1!=this.pageCount?(t[n]={index:a+1+this.splitPages,text:"……"},a=e-2):t[n]={index:a+1,text:a+1},!(20<++n));a++);this.pages=t,this.nextPage=this.pageNo+1>e?e:this.pageNo+1,this.prePage=1==this.pageNo?1:this.pageNo-1},next:function(){this.pageNo+1>this.pageCount||this.go(this.pageNo+1)},pre:function(){1!=this.pageNo&&this.go(this.pageNo-1)},checkAll:function(){null!=this.data&&(this.isCheckAll=!this.isCheckAll,o.forEach(this.data,function(e){e.selected!=t.isCheckAll&&"function"==typeof t.checkboxChange&&t.checkboxChange(e,i+1),e.selected=t.isCheckAll}))},getSelected:function(a){var l=[];return o.forEach(this.data,function(e,t){var n;!e.selected||null!=(n=a(e,t))&&l.push(n)}),l},pages:[]};return t.go(a&&a.pageNo||1),t}}),e.provider("$NLTables",function(){this.setI18n=function(e){o.extend(this.translateJson,e)},this.translateJson={"zh-cn":{checkAll:"全选",select:"选择",statistics:"统计",turnpage_word_1:"共",turnpage_word_2:"行, ",turnpage_word_4:"页"},en:{checkAll:"ALL",select:"Select",statistics:"Statistics",turnpage_word_1:"Total of ",turnpage_word_2:" rows, ",turnpage_word_4:" pages"}},this.$get=function(){return this}}),e.filter("NLTableTranslate",["$NLTables","$injector",function(l,e){function t(e){var t=o&&o.use()||"zh-cn",n=l.translateJson[t];if(null==n)return s(e);var a=n[e];return null!=a?a:s(e)}var o=e.has("$translate")?o=e.get("$translate"):void 0;function s(e){return o?o.instant(e):e}return t.$stateful=!0,t}])}(angular);